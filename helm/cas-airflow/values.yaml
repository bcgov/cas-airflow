route:
  clusterDomain: apps.silver.devops.gov.bc.ca

gcpLogsUpload:
  enable: true
  bucketSuffix: airflow-logs
  image:
    casShelf:
      repository: gcr.io/ggl-cas-storage/cas-shelf-tfe-add-app
      pullPolicy: Always
      tag: "0.1"

# The values we need to override from the airflow defaults
airflow:
  uid: 1002490000
  gid: 1002490000

  defaultAirflowRepository: gcr.io/ggl-cas-storage/cas-airflow
  defaultAirflowTag: "to_override"

  # Enable RBAC (default on most clusters these days)
  rbacEnabled: true

  # Environment variables for all airflow containers
  env:
    - name: GOOGLE_APPLICATION_CREDENTIALS
      value: /gcs/credentials.json

  # Images
  images:
    airflow:
      pullPolicy: Always
    pod_template:
      pullPolicy: Always

  # Secrets for all airflow containers
  secret:
    - envName: PGPASS
      secretName: cas-airflow-postgresql
      secretKey: postgres-password
    - envName: DEFAULT_USER_PASS
      secretName: airflow-default-user-password
      secretKey: default-user-pass
    - envName: AIRFLOW_NAMESPACE
      secretName: cas-namespaces
      secretKey: airflow-namespace
    - envName: GGIRCS_NAMESPACE
      secretName: cas-namespaces
      secretKey: ggircs-namespace
    - envName: CIIP_NAMESPACE
      secretName: cas-namespaces
      secretKey: ciip-namespace

  # Airflow database config
  data:
    metadataConnection:
      user: postgres
      pass: $PGPASS
      host: ~
      port: 5432
      db: postgres
      sslmode: disable
    resultBackendConnection:
      user: postgres
      pass: $PGPASS
      host: ~
      port: 5432
      db: postgres
      sslmode: disable

  # Airflow webserver settings
  webserver:
    replicas: 2
    defaultUser:
      enabled: true
      role: Admin
      username: cas-airflow-admin
      email: admin@example.com
      firstName: admin
      lastName: user
      password: "$(DEFAULT_USER_PASS)"

  # Configuration for postgresql subchart
  postgresql:
    enabled: true
    image: "registry.access.redhat.com/rhscl/postgresql-96-rhel7"
    imageTag: "1-51.1575996559"
    # postgres username and password are overridden in the metadata
    # postgresqlPassword: postgres
    # postgresqlUsername: postgres
    networkPolicy:
      enabled: false

  config:
    core:
      dag_concurrency: 1
    logging:
      logging_level: INFO
      remote_logging: True
      remote_base_log_folder: ~
      remote_log_conn_id: gcs_logs
    api:
      auth_backend: airflow.api.auth.backend.basic_auth
    webserver:
      username: "cas-airflow-admin"
      password: "$(DEFAULT_USER_PASS)"

    celery:
      default_queue: celery

    scheduler:
      min_file_process_interval: 30

    kubernetes:
      run_as_user: "{{ .Values.uid }}"
      delete_worker_pods: "False"

  # Git sync
  dags:
    persistence:
      enabled: false
    gitSync:
      enabled: false
